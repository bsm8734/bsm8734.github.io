<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2" /><meta name="author" content="Bae Soomin" /><meta property="og:locale" content="en_US" /><meta name="description" content="[DAY 9] Pandas 2" /><meta property="og:description" content="[DAY 9] Pandas 2" /><link rel="canonical" href="https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/" /><meta property="og:url" content="https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/" /><meta property="og:site_name" content="Always Awake Sally" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-28T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Bae Soomin" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Bae Soomin"},"description":"[DAY 9] Pandas 2","url":"https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/","@type":"BlogPosting","headline":"[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2","dateModified":"2021-03-30T03:40:57+09:00","datePublished":"2021-01-28T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/"},"@context":"https://schema.org"}</script><title>[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2 | Always Awake Sally</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/my_image/Sally_wallpaper.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Always Awake Sally</a></div><div class="site-subtitle font-italic">24시간이 모자라</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bsm8734" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['bsm8734','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jan 28, 2021, 12:00 AM +0900" > Jan 28 <i class="unloaded">2021-01-28T00:00:00+09:00</i> </span> by <span class="author"> Bae Soomin </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 30, 2021, 3:40 AM +0900" > Mar 30 <i class="unloaded">2021-03-30T03:40:57+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2789 words">15 min</span></div></div><div class="post-content"><h2 id="day-9-pandas-2"><strong>[DAY 9] Pandas 2</strong></h2><hr /><h3 id="group-by---basic">Group by - Basic</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sources/2021-01-28-10-27-06.png" alt="4" /></p><ul><li>SQL grroupby 명령어와 같음<li>split ➡ apply ➡ combine<li>과정을 거쳐서 연산함<li>pivot table<li><p>한 개이상의 column을 묶을 수 있음</p><li><code class="language-plaintext highlighter-rouge">df.groupby(기준이 되는 팀)[적용받는 컬럼].(적용받는 연산)</code><ul><li><code class="language-plaintext highlighter-rouge">df.groupby("Team")["Points"].sum()</code></ul></ul><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># data from:
</span><span class="n">ipl_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Team"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"Riders"</span><span class="p">,</span>
        <span class="s">"Riders"</span><span class="p">,</span>
        <span class="s">"Devils"</span><span class="p">,</span>
        <span class="s">"Devils"</span><span class="p">,</span>
        <span class="s">"Kings"</span><span class="p">,</span>
        <span class="s">"kings"</span><span class="p">,</span>
        <span class="s">"Kings"</span><span class="p">,</span>
        <span class="s">"Kings"</span><span class="p">,</span>
        <span class="s">"Riders"</span><span class="p">,</span>
        <span class="s">"Royals"</span><span class="p">,</span>
        <span class="s">"Royals"</span><span class="p">,</span>
        <span class="s">"Riders"</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s">"Rank"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="s">"Year"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2017</span><span class="p">],</span>
    <span class="s">"Points"</span><span class="p">:</span> <span class="p">[</span><span class="mi">876</span><span class="p">,</span> <span class="mi">789</span><span class="p">,</span> <span class="mi">863</span><span class="p">,</span> <span class="mi">673</span><span class="p">,</span> <span class="mi">741</span><span class="p">,</span> <span class="mi">812</span><span class="p">,</span> <span class="mi">756</span><span class="p">,</span> <span class="mi">788</span><span class="p">,</span> <span class="mi">694</span><span class="p">,</span> <span class="mi">701</span><span class="p">,</span> <span class="mi">804</span><span class="p">,</span> <span class="mi">690</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># groupby - 하나의 인자
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ipl_data</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"Team"</span><span class="p">)[</span><span class="s">"Points"</span><span class="p">].</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># groupby - 여러 인자
</span><span class="n">h_index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"Team"</span><span class="p">,</span> <span class="s">"Year"</span><span class="p">])[</span><span class="s">"Points"</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">h_index</span>
<span class="s">"""
팀별로 묶기
두개의 컬럼 이상으로 묶는다면, 계층적인 인덱스 구조라고 함
Team    Year
Devils  2014    863
        2015    673
Kings   2014    741
        2016    756
        2017    788
Riders  2014    876
        2015    789
        2016    694
        2017    690
Royals  2014    701
        2015    804
kings   2015    812
Name: Points, dtype: int64
"""</span>
</pre></table></code></div></div><h4 id="hierarchical-index"><strong>Hierarchical Index</strong></h4><ul><li>Groupby 명령의 결과물도 결국은 dataframe<li>두 개의 column으로 groupby를 할 경우, index가 두개 생성<li><code class="language-plaintext highlighter-rouge">unstack()</code>: Group으로 묶여진 데이터를 matrix 형태로 전환해줌<li><code class="language-plaintext highlighter-rouge">swaplevel()</code>: Index level을 변경할 수 있음<li><code class="language-plaintext highlighter-rouge">operations()</code>: Index level을 기준으로 기본 연산 수행 가능</ul><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="n">h_index</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># MultiIndex([(), (), ...], names=['Team', 'Year'])
</span>
<span class="n">h_index</span><span class="p">[</span><span class="s">"Devils"</span><span class="p">:</span><span class="s">"Kings"</span><span class="p">]</span> <span class="c1"># "Devils"~"Kings" 까지의 데이터
</span>
<span class="n">h_index</span><span class="p">.</span><span class="n">unstack</span><span class="p">().</span><span class="n">stack</span><span class="p">().</span><span class="n">unstack</span><span class="p">()</span>
<span class="s">"""
✔ unstack: Group으로 묶여진 데이터를 matrix 형태로 풀어줌
ex)
Year	2014	2015	2016	2017
Team				
Devils	863.0	673.0	NaN	NaN
Kings	741.0	NaN	756.0	788.0
Riders	876.0	789.0	694.0	690.0
Royals	701.0	804.0	NaN	NaN
kings	NaN	812.0	NaN	NaN

✔ stack: 데이터를 다시 묶어줌
ex)
Year  Team  
2014  Devils    863
2015  Devils    673
2014  Kings     741
2016  Kings     756
2017  Kings     788
2014  Riders    876
2015  Riders    789
2016  Riders    694
2017  Riders    690
2014  Royals    701
2015  Royals    804
      kings     812
Name: Points, dtype: int64
"""</span>

<span class="n">h_index</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1"># 앞의 인덱스를 없애준?
</span><span class="n">h_index</span><span class="p">.</span><span class="n">swaplevel</span><span class="p">()</span> <span class="c1"># 레벨을 바꿔줌 Year Team =&gt; Team Year 이렇게 분류
</span><span class="n">h_index</span><span class="p">.</span><span class="n">swaplevel</span><span class="p">().</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 레벨 0 인덱스 기준으로 인덱스를 sorting
</span><span class="n">h_index</span><span class="p">.</span><span class="n">swaplevel</span><span class="p">().</span><span class="n">sort_values</span><span class="p">()</span> <span class="c1"># values기준으로 인덱스를 sorting
</span>
<span class="nb">type</span><span class="p">(</span><span class="n">h_index</span><span class="p">)</span> <span class="c1"># Series data (컬럼이 두개이지만 df 아니로 series!)
</span>
<span class="c1"># multi index 일때는 level만 지정해주면, 특정 level에만 접근하여 연산 가능
</span><span class="n">h_index</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">h_index</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></table></code></div></div><h4 id="grouped"><strong>grouped()</strong></h4><ul><li><code class="language-plaintext highlighter-rouge">grouped</code><ul><li>Groupby에 의해 Split된 상태를 추출 가능함<li>특정 key값을 가진 그룹의 정보만 추출 가능<li>추출된 group 정보에는 세 가지 유형의 <code class="language-plaintext highlighter-rouge">apply</code>가 가능함<li>Aggregation: 요약된 통계정보를 추출해 줌 (<code class="language-plaintext highlighter-rouge">sum, min</code>)<li>Transformation: 해당 정보를 변환해줌 (lambda filter, 데이터 변환)<li>Filtration: 특정 정보를 제거 하여 보여주는 필터링 기능(제거, 검색, 필터링)</ul><li>aggregation: <code class="language-plaintext highlighter-rouge">agg()</code><ul><li>특정 컬럼에 여러개의 function을 Apply 할 수 도 있음</ul><li>transformation: <code class="language-plaintext highlighter-rouge">transform()</code><ul><li>Aggregation과 달리 key값 별로 요약된 정보가 아님<li>개별 데이터의 변환을 지원함<li>단 max나 min 처럼 Series 데이터에 적용되는 데이터 들은 Key값을 기준으로 Grouped 된 데이터 기준</ul><li><code class="language-plaintext highlighter-rouge">filter()</code><ul><li>특정 조건으로 데이터를 검색할 때 사용<li>filter안에는 boolean 조건이 존재해야함<li>len(x)는 grouped된 dataframe 개수</ul></ul><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c1"># 그룹별로 나눠진 split 상태(1단계)에서의 값을 가져올 수 있음
# = grouped 상태
</span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"Team"</span><span class="p">)</span> <span class="c1"># 기준 column으로 데이터 나눔
# grouped: generator 상태
# list(grouped)
</span>
<span class="c1"># for key, value in df
# key, value 상태로 뽑을 수 있는 상태 = grouped 상태
# Tuple 형태로 그룹의 key 값, Value값이 추출됨
</span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span> 
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

<span class="n">grouped</span><span class="p">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">"Devils"</span><span class="p">)</span> 
<span class="c1"># 특정 그룹에 있는 상태를 가져옴
# 특정 key값을 가진 그룹의 정보만 추출 가능
</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="c1"># 컬럼에 적용
</span>
<span class="c1"># grouped 된 상태에서 ✔ 컬럼별로 연산 진행 ✔
# 그룹별로 컬럼에 적용
# 특정 컬럼에 여러개의 function을 Apply 할 수 도 있음
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">)</span>
<span class="c1"># 컬럼에 적용시키되, 그룹별로 출력
</span>
<span class="n">df</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">describe</span><span class="p">().</span><span class="n">T</span>

<span class="c1"># Transformation ?????
# grouped 되어있는 상태에서 각 컬럼별로 동일한 연산 진행
# 단, max나 min 처럼 Series 데이터에 적용되는 데이터 들은 Key값을 기준으로 Grouped된 데이터 기준
# 각각의 값에 영향을 줄 수 있게 함
# 위의 operataion은 컬럼별로 연산해서 하나의 값으로 요약했다면, 얘는 요약하는게 아니라 하나의 데이터 자리에는 반드시 하나의 값이 들어가게 됨
</span>
<span class="c1"># grouped는 이미 df.groupby() 연산을 거친 이후의 상태임
# 정규화
</span><span class="n">score</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="p">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="n">score</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s">"Team"</span><span class="p">].</span><span class="n">valu_counts</span><span class="p">()</span>
<span class="c1"># filter
</span><span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"Team"</span><span class="p">).</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"Team"</span><span class="p">).</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">"Points"</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="p">)</span>
<span class="c1"># "Team"별로 (묶어서) points의 mean이 700 초과인 것만 뽑아라!
</span><span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"Team"</span><span class="p">).</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">"Points"</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">)</span>
</pre></table></code></div></div><hr /><h3 id="pivot-table-crosstab"><strong>Pivot table Crosstab</strong></h3><ul><li>Pivot Table<ul><li>우리가 excel에서 보던 그 것!<li>Index 축은 groupby와 동일함<li>Column에 추가로 labeling 값을 추가하여,<li>Value에 numeric type 값을 aggregation 하는 형태</ul><li>Crosstab<ul><li>특허 두 칼럼에 교차 빈도, 비율, 덧셈 등을 구할 때 사용<li>Pivot table의 특수한 형태<li>User-Item Rating Matrix 등을 만들 때 사용가능함<li>두 데이터가 얼마나 관련이 있는지 알 수 있음</ul><li>groupby에 unstack을 사용하는 것보다 Pivot table, Crosstab을 사용하면 더 편히 사용 가능<li>컬럼에 labeling 값을 붙여서 aggregation 해주기</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sources/2021-01-28-11-21-09.png" alt="33" /></p><ul><li>index, value/col 지정<li>aggfunc: 연산자 지정<li>fill_value: NaN값을 어떤 값으로 대체시킬 것인지</ul><h4 id="pivot-table">Pivot Table</h4><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>  <span class="n">df_phone</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"./data/phone_data.csv"</span><span class="p">)</span>
  <span class="n">df_phone</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_phone</span><span class="p">[</span><span class="s">"date"</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">dateutil</span><span class="p">.</span><span class="n">parser</span><span class="p">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">df_phone</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>

  <span class="n">df_phone</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span>
      <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s">"duration"</span><span class="p">],</span>
      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">df_phone</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">df_phone</span><span class="p">.</span><span class="n">item</span><span class="p">],</span>
      <span class="n">columns</span><span class="o">=</span><span class="n">df_phone</span><span class="p">.</span><span class="n">network</span><span class="p">,</span>
      <span class="n">aggfunc</span><span class="o">=</span><span class="s">"sum"</span><span class="p">,</span>
      <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">df_phone</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"month"</span><span class="p">,</span> <span class="s">"item"</span><span class="p">,</span> <span class="s">"network"</span><span class="p">])[</span><span class="s">"duration"</span><span class="p">].</span><span class="nb">sum</span><span class="p">().</span><span class="n">unstack</span><span class="p">()</span>
  <span class="c1"># 하면 뒤의 값과 비슷하게 나옴
</span></pre></table></code></div></div><h4 id="crosstab">Crosstab</h4><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>  <span class="n">df_movie</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/movie_rating.csv"</span><span class="p">)</span>
  <span class="n">df_movie</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>

  <span class="n">df_movie</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span>
      <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s">"rating"</span><span class="p">],</span>
      <span class="n">index</span><span class="o">=</span><span class="n">df_movie</span><span class="p">.</span><span class="n">critic</span><span class="p">,</span>
      <span class="n">columns</span><span class="o">=</span><span class="n">df_movie</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
      <span class="n">aggfunc</span><span class="o">=</span><span class="s">"sum"</span><span class="p">,</span>
      <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">pd</span><span class="p">.</span><span class="n">crosstab</span><span class="p">(</span>
      <span class="n">index</span><span class="o">=</span><span class="n">df_movie</span><span class="p">.</span><span class="n">critic</span><span class="p">,</span>
      <span class="n">columns</span><span class="o">=</span><span class="n">df_movie</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
      <span class="n">values</span><span class="o">=</span><span class="n">df_movie</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span>
      <span class="n">aggfunc</span><span class="o">=</span><span class="s">"first"</span><span class="p">,</span>
  <span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="n">df_movie</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"critic"</span><span class="p">,</span> <span class="s">"title"</span><span class="p">]).</span><span class="n">agg</span><span class="p">({</span><span class="s">"rating"</span><span class="p">:</span> <span class="s">"first"</span><span class="p">}).</span><span class="n">unstack</span><span class="p">()</span>
  <span class="c1"># 위의 값과 동일한 결과!
</span></pre></table></code></div></div><hr /><h3 id="merge--concat"><strong>Merge &amp; Concat</strong></h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sources/2021-01-28-10-40-35.png" alt="42" /></p><h4 id="merge"><strong>merge</strong></h4><ul><li>SQL에서 많이 사용하는 Merge와 같은 기능<li>두 개의 데이터를 하나로 합침(하나의 기준점을 통해)<li>데이터를 어떻게 합칠것인가!<li><code class="language-plaintext highlighter-rouge">on</code>인자: 기준인자 양쪽에 다 같은 컬럼이 있어야함<ul><li>둘의 프레임을 합칠 수 있음(같은 값이 있는 것들만!)</ul><li><p>join method 라고 부름</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"subject_id"</span><span class="p">:</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">,</span> <span class="s">"5"</span><span class="p">,</span> <span class="s">"7"</span><span class="p">,</span> <span class="s">"8"</span><span class="p">,</span> <span class="s">"9"</span><span class="p">,</span> <span class="s">"10"</span><span class="p">,</span> <span class="s">"11"</span><span class="p">],</span>
    <span class="s">"test_score"</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df_a</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="s">"test_score"</span><span class="p">])</span>
<span class="s">"""
  subject_id	test_score
0	1	51
1	2	15
2	3	15
3	4	61
4	5	16
5	7	14
6	8	15
7	9	1
8	10	61
9	11	16
"""</span>

<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"subject_id"</span><span class="p">:</span> <span class="p">[</span><span class="s">"4"</span><span class="p">,</span> <span class="s">"5"</span><span class="p">,</span> <span class="s">"6"</span><span class="p">,</span> <span class="s">"7"</span><span class="p">,</span> <span class="s">"8"</span><span class="p">],</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Billy"</span><span class="p">,</span> <span class="s">"Brian"</span><span class="p">,</span> <span class="s">"Bran"</span><span class="p">,</span> <span class="s">"Bryce"</span><span class="p">,</span> <span class="s">"Betty"</span><span class="p">],</span>
    <span class="s">"last_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Bonder"</span><span class="p">,</span> <span class="s">"Black"</span><span class="p">,</span> <span class="s">"Balwner"</span><span class="p">,</span> <span class="s">"Brice"</span><span class="p">,</span> <span class="s">"Btisan"</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="s">"first_name"</span><span class="p">,</span> <span class="s">"last_name"</span><span class="p">])</span>
<span class="s">"""
  subject_id	first_name	last_name
0	4	Billy	Bonder
1	5	Brian	Black
2	6	Bran	Balwner
3	7	Bryce	Brice
4	8	Betty	Btisan
"""</span>
<span class="c1">##########################################################################
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">)</span>
<span class="s">"""
"subject_id"라는 컬럼이 있는 경우,
양쪽에 같은 값이 있는 경우에만 합쳐져서 나옴(하나라도 없으면 버림)
  subject_id	test_score	first_name	last_name
0	4	61	Billy	Bonder
1	5	16	Brian	Black
2	7	14	Bryce	Brice
3	8	15	Betty	Btisan
"""</span>
<span class="c1">##########################################################################
# (left df, right df, )
# 두 dataframe의 column 이름이 다를때 이름 지정해서 합쳐줄 수 있음 
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">)</span>

<span class="c1"># 규칙있음
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"left"</span><span class="p">)</span> <span class="c1"># left join # left 쪽의 데이터만 보여주고 없으면 NaN
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"right"</span><span class="p">)</span> <span class="c1"># right join
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"outer"</span><span class="p">)</span> <span class="c1"># full(outer) join # 양쪽을 다 살림, 빈곳은 NaN # full : 일단 같은거 붙이고, 없는건 정리하여 붙임
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"inner"</span><span class="p">)</span> <span class="c1"># inner join (default) 양쪽 다 같은 값이 있을때
</span>
<span class="s">"""
how="left"인 경우,
왼쪽값을 기준으로 모두 출력
왼쪽에만 있고 오른쪽에 없는 값은 NaN을 넣어 출력
오른쪽에만 있고 왼쪽에 없는 값은 출력하지 않음
"""</span>
<span class="c1">##########################################################################
</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># 인덱스 값을 기준으로 붙임
# 인덱스 값은 지정하지 않았을 경우에 숫자임
# 두 그룹이 중복되는 경우 존재 -&gt; 그럴때 _x _y 이렇게 붙어서 칼럼으로 들어옴
# last_name_x  last_name_y
</span></pre></table></code></div></div></ul><h4 id="concat"><strong>concat</strong></h4><ul><li>같은 형태의 데이터를 붙이는 연산작업<li>기본 명제: a와 b가 같은 컬럼을 가지고 있을 때<li><p><code class="language-plaintext highlighter-rouge">axis=1</code>: 옆으로 붙음</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="n">raw_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"subject_id"</span><span class="p">:</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">,</span> <span class="s">"5"</span><span class="p">],</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Alex"</span><span class="p">,</span> <span class="s">"Amy"</span><span class="p">,</span> <span class="s">"Allen"</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">,</span> <span class="s">"Ayoung"</span><span class="p">],</span>
    <span class="s">"last_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Anderson"</span><span class="p">,</span> <span class="s">"Ackerman"</span><span class="p">,</span> <span class="s">"Ali"</span><span class="p">,</span> <span class="s">"Aoni"</span><span class="p">,</span> <span class="s">"Atiches"</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df_a</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="s">"first_name"</span><span class="p">,</span> <span class="s">"last_name"</span><span class="p">])</span>

<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"subject_id"</span><span class="p">:</span> <span class="p">[</span><span class="s">"4"</span><span class="p">,</span> <span class="s">"5"</span><span class="p">,</span> <span class="s">"6"</span><span class="p">,</span> <span class="s">"7"</span><span class="p">,</span> <span class="s">"8"</span><span class="p">],</span>
    <span class="s">"first_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Billy"</span><span class="p">,</span> <span class="s">"Brian"</span><span class="p">,</span> <span class="s">"Bran"</span><span class="p">,</span> <span class="s">"Bryce"</span><span class="p">,</span> <span class="s">"Betty"</span><span class="p">],</span>
    <span class="s">"last_name"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Bonder"</span><span class="p">,</span> <span class="s">"Black"</span><span class="p">,</span> <span class="s">"Balwner"</span><span class="p">,</span> <span class="s">"Brice"</span><span class="p">,</span> <span class="s">"Btisan"</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"subject_id"</span><span class="p">,</span> <span class="s">"first_name"</span><span class="p">,</span> <span class="s">"last_name"</span><span class="p">])</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">])</span>
<span class="n">df_new</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">df_a</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_b</span><span class="p">)</span> <span class="c1"># concat과 같은 역할
</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 옆으로 붙음
</span><span class="n">df_new</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></table></code></div></div></ul><hr /><h3 id="persistence"><strong>Persistence</strong></h3><ul><li>데이터프레임 IO: 대표적으로 DB 사용하는 것<ul><li>sqlite: file 형태로 데이터베이스</ul><li>Database connection<ul><li>Data loading시 db connection 기능을 제공함</ul><li>엑셀과 피클 형태로 write하고 싶을 경우<ul><li><code class="language-plaintext highlighter-rouge">conda install openpyxl</code><li><code class="language-plaintext highlighter-rouge">conda install XlsxWriter</code></ul><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1"># Database 연결코드
</span><span class="kn">import</span> <span class="nn">sqlite3</span>  <span class="c1"># pymysql &lt;- 설치
</span>
<span class="c1"># 데이터베이스 로드
</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"./data/flights.db"</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"select * from airlines limit 5;"</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="c1"># results 튜플형태 데이터 들어옴
</span>
<span class="c1"># 데이터 로드
</span><span class="n">df_airplines</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"select * from airlines;"</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_airplines</span>
<span class="c1"># db연결 conn을 사용하여 dataframe 생성
</span>
<span class="n">df_airports</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"select * from airports;"</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"select * from routes;"</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="c1"># 엑셀과 피클형태로 저장할 수 있음 
</span><span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s">"./data/df_routes.xlsx"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s">"xlsxwriter"</span><span class="p">)</span>
<span class="n">df_routes</span><span class="p">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s">"Sheet1"</span><span class="p">)</span>

<span class="n">df_routes</span><span class="p">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s">"./data/df_routes.pickle"</span><span class="p">)</span>

<span class="n">df_routes_pickle</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s">"./data/df_routes.pickle"</span><span class="p">)</span>
<span class="n">df_routes_pickle</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</pre></table></code></div></div><li>XLS persistence<ul><li>Dataframe의 엑셀 추출 코드<li>Xls 엔진으로 openpyxls 또는 XlsxWrite 사용</ul><li>Pickle persistence<ul><li>가장 일반적인 python 파일 persistence<li>to_pickle, read_pickle 함수 사용</ul></ul><hr /><h4 id="case-study"><strong>case study</strong></h4><ul><li>ppt 참고(p22~)<ul><li><code class="language-plaintext highlighter-rouge">.plot()</code>: 시각화 (matplotlib)<li><code class="language-plaintext highlighter-rouge">df_phone.groupby(["month", "item"])[duration].count().unstack().plot()</code><li><code class="language-plaintext highlighter-rouge">.groupby("month", "as_index=False)</code> : month로 그룹화 하지만 인덱스로 삼지않음<li>operation 넣을 떄 dict type으로 다채롭게 넣을 수 있음<li><code class="language-plaintext highlighter-rouge">.droplevel(level=0)</code><li><code class="language-plaintext highlighter-rouge">grouped.rename(column={"min":"min_dur", "max":"max_dur", ...})</code><li><code class="language-plaintext highlighter-rouge">grouped.add_prefix("duration_")</code> : 컬럼 앞에 덧붙여서 출력해줌</ul><li><p>join, concat case</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_name</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">"./data"</span><span class="p">)</span> <span class="k">if</span> <span class="n">file_name</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">"xlsx"</span><span class="p">)]</span>
<span class="n">files</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"excel-comp-data.xlsx"</span><span class="p">)</span>
<span class="n">files</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"df_routes.xlsx"</span><span class="p">)</span>

<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="c1"># df_list = [pd.read_excel("data/" + df_filename) for df_filename in files]
</span><span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="n">df_filename</span><span class="p">))</span> <span class="k">for</span> <span class="n">df_filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span> <span class="c1"># 읽어서 리스트에 저장
</span><span class="n">status</span> <span class="o">=</span> <span class="n">df_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sales</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="n">merge_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">sales</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"inner"</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"account number"</span><span class="p">)</span>
<span class="n">merge_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"status"</span><span class="p">,</span> <span class="s">"name_x"</span><span class="p">])[</span><span class="s">"quantity"</span><span class="p">,</span> <span class="s">"ext price"</span><span class="p">].</span><span class="nb">sum</span><span class="p">().</span><span class="n">reset_index</span><span class="p">().</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">"status"</span><span class="p">,</span> <span class="s">"quantity"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># status 기준 할거면 how="left"
</span>
<span class="c1"># how="left" 쓸거면
# del merge_df["name_x"]
</span></pre></table></code></div></div></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%B6%80%EC%8A%A4%ED%8A%B8%EC%BA%A0%ED%94%84-ai-tech/'>네이버 부스트캠프 AI Tech</a>, <a href='/categories/python/'>Python</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >Python</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2 - Always Awake Sally&url=https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2 - Always Awake Sally&u=https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[부스트캠프 AI Tech / Day9] 파이썬 Pandas 2 - Always Awake Sally&url=https://bsm8734.github.io/posts/bc-d009-1-python-pandas2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/bc-stage1-d002-lecture/">[부스트캠프 AI Tech / P Stage1] Lecture2 - Dataset & Data Generation</a><li><a href="/posts/bc-stage1-d002-TIL/">[부스트캠프 AI Tech / P Stage1] Day2 TIL</a><li><a href="/posts/bc-d002-5-python-condition-loop/">[부스트캠프 AI Tech / Day2] 파이썬 조건문, 반복문</a><li><a href="/posts/bc-d002-6-python-string/">[부스트캠프 AI Tech / Day2] 파이썬 String</a><li><a href="/posts/bc-d002-today/">[부스트캠프 AI Tech / Day2] Today</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/today/">today</a> <a class="post-tag" href="/tags/dl/">DL</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/imageclassification/">ImageClassification</a> <a class="post-tag" href="/tags/graph/">Graph</a> <a class="post-tag" href="/tags/%EA%B5%AC%EA%B8%80-%EC%8A%A4%ED%84%B0%EB%94%94%EC%9E%BC/">구글 스터디잼</a> <a class="post-tag" href="/tags/nlp/">NLP</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/bc-d002-5-python-condition-loop/"><div class="card-body"> <span class="timeago small" > Jan 19 <i class="unloaded">2021-01-19T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[부스트캠프 AI Tech / Day2] 파이썬 조건문, 반복문</h3><div class="text-muted small"><p> [DAY 2] Conditionals and Loops 조건문 (Conditionals) 조건문: 조건에 따라 특정한 동작을 하게하는 명령어 조건문은 조건을 나타내는 기준과 실행해야 할 명령으로 구성됨 조건의 참, 거짓에 따라 실행해야 할 명령이 수행되거나 되지 않음 파이썬은 조건문으로 if , else , elif 등의 예약어...</p></div></div></a></div><div class="card"> <a href="/posts/bc-d002-6-python-string/"><div class="card-body"> <span class="timeago small" > Jan 19 <i class="unloaded">2021-01-19T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[부스트캠프 AI Tech / Day2] 파이썬 String</h3><div class="text-muted small"><p> [DAY 2] String 문자열(string) 시퀀스 자료형 ➡ 문자형 데이터를 메모리에 저장 list와 비슷한 구조 ➡ 1byte의 메모리가 순차적으로 나열되어있다고 생각 영문 1글자 = 1byte 인덱싱(Indexing) 문자열의 각 문자는 개별주소(offset)를 가짐 ➡ 이 주소를 사용하여 할당된 값을 가져오는 ...</p></div></div></a></div><div class="card"> <a href="/posts/bc-d003-1-python-stack-queue/"><div class="card-body"> <span class="timeago small" > Jan 20 <i class="unloaded">2021-01-20T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[부스트캠프 AI Tech / Day3] 파이썬 Stack & Queue</h3><div class="text-muted small"><p> [DAY 3] Stack &amp; Queue Python Data Structure 특징이 있는 정보를 저장하는 방법 파이썬 기본 데이터 구조 스택과 큐(stack &amp; queue with list) 튜플과 집합(tuple &amp; set) 사전(dictionary) Coll...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/bc-d009-2-aimath-probability-theory/" class="btn btn-outline-primary"><p>[부스트캠프 AI Tech / Day9] Math_AI 확률론</p></a> <a href="/posts/bc-d009-today/" class="btn btn-outline-primary"><p>[부스트캠프 AI Tech / Day9] Today</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/username">BaeSoomin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/today/">today</a> <a class="post-tag" href="/tags/dl/">DL</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/math/">Math</a> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/imageclassification/">ImageClassification</a> <a class="post-tag" href="/tags/graph/">Graph</a> <a class="post-tag" href="/tags/%EA%B5%AC%EA%B8%80-%EC%8A%A4%ED%84%B0%EB%94%94%EC%9E%BC/">구글 스터디잼</a> <a class="post-tag" href="/tags/nlp/">NLP</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } }, tex2jax: { inlineMath: [ ['$', '$'] ], displayMath: [ ['$$', '$$'] ], processEscapes: true, } }); MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) { alert("Math Processing Error: "+message[1]); }); MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) { alert("Math Processing Error: "+message[1]); }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bsm8734.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
